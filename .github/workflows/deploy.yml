name: Deploy Worker


on:
  push:
    branches:
      - main   # üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–µ–ø–ª–æ—ó–º–æ –ø—Ä–∏ –ø—É—à—ñ –≤ –≥—ñ–ª–∫—É main
  workflow_dispatch:  # üëà –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Ä—É—á–Ω—É

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ Node.js (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –¥–ª—è Wrangler)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # 3Ô∏è‚É£ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (—è–∫—â–æ —î package.json)
      - name: Install dependencies
        run: |
          if [ -f package.json ]; then
            npm install
          fi

      # 4Ô∏è‚É£ –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Wrangler
      - name: Deploy to Cloudflare Workers
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CF_API_TOKEN }}
          accountId: ${{ secrets.CF_ACCOUNT_ID }}
          command: publish
